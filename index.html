<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Phoropter</title>
    <link rel="icon" type="image/png" href="phoropter-icon-2.png">
    <link rel="shortcut icon" type="image/png" href="phoropter-icon-2.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Loading screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <img src="phoropter-logo-2.png" alt="Phoropter" class="loading-logo">
            <h2>Code Phoropter</h2>
            <p class="loading-text">Loading fonts...</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="loadingProgressFill"></div>
                </div>
                <div class="progress-text" id="loadingProgressText">0 / 0 fonts loaded</div>
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        <div class="header">
            <div class="title-with-logo">
                <img src="phoropter-logo-2.png" alt="Phoropter" class="logo">
                <div class="title-text">
                    <h1>Code Phoropter</h1>
                    <p class="subtitle">Find your perfect code display settings</p>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="status" id="status">Starting calibration...</p>
        </div>


        <div class="comparison-container" id="comparisonContainer">
            <div class="code-panel" id="panelA">
                <div class="panel-label">Option A</div>
                <div class="panel-summary" id="summaryA"></div>
                <pre><code id="codeA"></code></pre>
            </div>
            <div class="code-panel" id="panelB">
                <div class="panel-label">Option B</div>
                <div class="panel-summary" id="summaryB"></div>
                <pre><code id="codeB"></code></pre>
            </div>
            <!-- Unified button container -->
            <div class="button-container" id="buttonContainer">
                <button class="floating-choice-btn" id="btnA" onclick="selectOption('A')">
                    <span class="key-hint">[A]</span> Prefer A
                </button>
                <div class="center-buttons">
                    <button class="floating-choice-btn neutral" id="btnEqual" onclick="selectOption('equal')">
                        <span class="key-hint">[S]</span> No Preference
                    </button>
                    <button class="floating-choice-btn skip-stage" id="btnSkipStage" onclick="skipCurrentStage()" style="display: none;">
                        <span class="key-hint">[W]</span> Skip Stage
                    </button>
                </div>
                <button class="floating-choice-btn" id="btnB" onclick="selectOption('B')">
                    <span class="key-hint">[D]</span> Prefer B
                </button>
            </div>
            <!-- Draggable divider for slider compare mode -->
            <div class="slider-divider" id="sliderDivider" style="display: none;">
                <div class="divider-handle">
                    <div class="divider-grip"></div>
                </div>
            </div>
        </div>

        <div class="description-section">
            <p class="description">Just like an eye doctor uses a phoropter to find your perfect vision prescription through "better 1 or 2?" comparisons, Code Phoropter helps you discover your ideal coding font, size, colors, and spacing through side-by-side A/B tests. Compare code samples across different settings until you find the combination that makes your code most readable and comfortable for long coding sessions. Once you've found your perfect settings, export them directly to your favorite editor or terminal.</p>
        </div>

        <div id="fontFamilySelector" class="font-family-selector hidden">
            <h2>Choose Your Preferred Font Style</h2>
            <p class="selector-subtitle">Click on the font style that appeals to you most</p>
            <div class="font-families-grid" id="fontFamiliesGrid">
                <!-- Font family options will be dynamically populated -->
            </div>
            
            <div id="importSection" class="import-section-inline">
                <h4>Import Previous Settings</h4>
                <div class="import-field">
                    <input type="text" id="importSettings" placeholder="Paste your settings string here...">
                    <button onclick="importAndStart()">Import & Start</button>
                </div>
            </div>
        </div>


        

        <div class="footer">
            <a href="about.html" class="about-link">About</a>
            <div class="theme-toggle">
                <label class="toggle-switch">
                    <span class="toggle-label" id="toggleLabel">Dark <u>M</u>ode</span>
                    <input type="checkbox" id="themeToggle" onchange="toggleThemeMode()" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="slider-compare-toggle">
                <label class="toggle-switch">
                    <span class="toggle-label">Slider <u>C</u>ompare</span>
                    <input type="checkbox" id="sliderCompareToggle" onchange="toggleSliderCompare()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <select id="languageSelect" onchange="changeLanguage()" disabled>
                <option value="javascript">JavaScript (React)</option>
                <option value="python">Python (Async)</option>
                <option value="rust">Rust (Cache)</option>
                <option value="go">Go (Web Service)</option>
                <option value="java">Java (Spring Boot)</option>
                <option value="clojure">Clojure (Ring)</option>
                <option value="css">CSS (Normalize)</option>
                <option value="html">HTML (Boilerplate)</option>
                <option value="json">JSON (VS Code)</option>
                <option value="markdown">Markdown (Unicode Scripts)</option>
                <option value="legal">Legal (GDPR)</option>
                <option value="powerline">Powerline & Nerd Fonts</option>
                <option value="custom">üìÅ My Own Code...</option>
            </select>
            <button id="resetBtn" class="reset-btn" onclick="resetTest()" disabled>Start Over</button>
            <button id="skipRoleBtn" class="skip-role-btn hidden" onclick="skipRoleStage()">Skip Role</button>
        </div>

        

        <div id="results" class="results hidden">
            <h2>Your Ideal Code Display Settings</h2>
            <div class="result-details" id="resultDetails"></div>
            <div class="result-preview">
                <h3>Preview with your settings:</h3>
                <pre><code id="resultCode"></code></pre>
            </div>
            <div class="result-actions">
                <button onclick="copySettings()">Copy CSS Settings</button>
                <button onclick="downloadFontPackage()">Download Font Package</button>
                <button onclick="resetTest()">Try Again</button>
            </div>
        </div>

        <!-- Icons/Nerd Font prompt modal -->
        <div id="iconsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="iconsModalTitle">
            <div class="modal-content">
                <h3 id="iconsModalTitle">Use Powerline/Nerd Font Icons?</h3>
                <p class="modal-text">We detected a patched icon font for your selected family. While viewing a terminal sample, you can choose to use a patched variant for powerline and file icons.</p>
                <div id="iconsOptions" class="modal-options"></div>
                <div class="modal-actions">
                    <button id="iconsKeepBaseBtn">Keep Base</button>
                    <button id="iconsUsePatchedBtn" class="primary">Use Patched</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Font Detective library for reliable font detection (local copy) -->
    <script src="vendor/font-detective.js"></script>
    <!-- WebFont Loader for loading Google Fonts and embedded fonts -->
    <script src="vendor/webfont.js"></script>
    <!-- JSZip library for creating zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Databases are JSON; app.js fetches them -->
    <!-- Multi-font roles metadata and presets -->
    <script src="font-roles.js"></script>
    <!-- highlight.js (local copy expected in vendor/); no theme CSS on purpose -->
    <script src="vendor/highlight.min.js"></script>
    <script src="text-samples.js"></script>
    <script src="app.js"></script>
</body>
</html>
